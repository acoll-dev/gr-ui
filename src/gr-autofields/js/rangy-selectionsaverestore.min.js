!function(e,r){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(r.rangy)}(function(e){return e.createModule("SaveRestore",["WrappedRange"],function(e,r){function a(e,r){return(r||document).getElementById(e)}function o(e,r){var o,a="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),s=n.getDocument(e.startContainer),l=e.cloneRange();return l.collapse(r),o=s.createElement("span"),o.id=a,o.style.lineHeight="0",o.style.display="none",o.className="rangySelectionBoundary",o.appendChild(s.createTextNode(t)),l.insertNode(o),o}function s(e,n,t,o){var s=a(t,e);s?(n[o?"setStartBefore":"setEndBefore"](s),s.parentNode.removeChild(s)):r.warn("Marker element has been removed. Cannot restore selection.")}function l(e,r){return r.compareBoundaryPoints(e.START_TO_START,e)}function i(r,n){var t,a,s=e.DomRange.getRangeDocument(r),l=r.toString();return r.collapsed?(a=o(r,!1),{document:s,markerId:a.id,collapsed:!0}):(a=o(r,!1),t=o(r,!0),{document:s,startMarkerId:t.id,endMarkerId:a.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+l+"', new text: '"+r.toString()+"'"}})}function d(n,t){var o=n.document;"undefined"==typeof t&&(t=!0);var l=e.createRange(o);if(n.collapsed){var i=a(n.markerId,o);if(i){i.style.display="inline";var d=i.previousSibling;d&&3==d.nodeType?(i.parentNode.removeChild(i),l.collapseToPoint(d,d.length)):(l.collapseBefore(i),i.parentNode.removeChild(i))}else r.warn("Marker element has been removed. Cannot restore selection.")}else s(o,l,n.startMarkerId,!0),s(o,l,n.endMarkerId,!1);return t&&l.normalizeBoundaries(),l}function c(r,n){var o,s,t=[];r=r.slice(0),r.sort(l);for(var d=0,c=r.length;c>d;++d)t[d]=i(r[d],n);for(d=c-1;d>=0;--d)o=r[d],s=e.DomRange.getRangeDocument(o),o.collapsed?o.collapseAfter(a(t[d].markerId,s)):(o.setEndBefore(a(t[d].endMarkerId,s)),o.setStartAfter(a(t[d].startMarkerId,s)));return t}function f(n){if(!e.isSelectionValid(n))return r.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var t=e.getSelection(n),a=t.getAllRanges(),o=1==a.length&&t.isBackward(),s=c(a,o);return o?t.setSingleRange(a[0],"backward"):t.setRanges(a),{win:n,rangeInfos:s,restored:!1}}function u(e){for(var r=[],n=e.length,t=n-1;t>=0;t--)r[t]=d(e[t],!0);return r}function g(r,n){if(!r.restored){var t=r.rangeInfos,a=e.getSelection(r.win),o=u(t),s=t.length;1==s&&n&&e.features.selectionHasExtend&&t[0].backward?(a.removeAllRanges(),a.addRange(o[0],!0)):a.setRanges(o),r.restored=!0}}function v(e,r){var n=a(r,e);n&&n.parentNode.removeChild(n)}function m(e){for(var a,r=e.rangeInfos,n=0,t=r.length;t>n;++n)a=r[n],a.collapsed?v(e.doc,a.markerId):(v(e.doc,a.startMarkerId),v(e.doc,a.endMarkerId))}var n=e.dom,t="ï»¿";e.util.extend(e,{saveRange:i,restoreRange:d,saveRanges:c,restoreRanges:u,saveSelection:f,restoreSelection:g,removeMarkerElement:v,removeMarkers:m})}),e},this);