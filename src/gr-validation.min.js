angular.module("grValidation",["grValidation.provider","grValidation.directive"]),angular.module("grValidation.provider",["grScriptbind"]).provider("$grValidation",function(){var s,o,l,n=1,a=1,i={compile:{},injector:{},scriptbind:{},filter:{},http:{},scope:{},timeout:{},window:{}},u={config:{},fields:{},masks:{},rules:{}};l={config:{form:[],file:{mask:{},message:{},template:{},$mask:{url:"",config:{},set:function(e){angular.forEach(e,function(e,t){l.config.file.mask[t]=e})}},$message:{url:"",set:function(e){l.config.file.message=e}},$template:{path:"",extension:"",set:function(){angular.forEach(l.field,function(e,t){l.config.file.template[t]=l.config.file.$template.path+"/"+e.template+l.config.file.$template.extension}),l.config.file.template.form=l.config.file.$template.path+"/form"+l.config.file.$template.extension,l.config.file.template.alert=l.config.file.$template.path+"/alert"+l.config.file.$template.extension},get:function(e,t){return t?l.config.file.template[l.field[e].template]:e?l.config.file.template[e]:l.config.file.template}}},$form:{set:function(e){angular.forEach(e,function(e,t){l.config.form[t]=e,l.config.form.length++})}}},"default":{method:"onSubmit",labelType:"placeholder",validate:!0},form:{},field:{},rules:{0:{name:"required",type:"boolean",rule:function(e){return""!==e&&null!==e&&void 0!==e&&"undefined"!==e&&"on"!==e&&e}}},translator:{enable:!1,module:""},$destroy:function(e){return"all"!==e?l.form[e]?void delete l.form[e]:void 0:void(l.form={})},$field:{set:function(e){e?angular.forEach(e,function(e,t){l.field[t]=e}):console.error("Fields configuration file not found.")}},$get:function(e){if(e&&"string"===String(typeof e)&&"external"!==e){var e=l.form[e];return e?{element:e.element,grForm:e.grForm,id:e.id,name:e.name,noAjaxSubmit:e.$noAjaxSubmit,reset:e.$reset,submit:e.$validate,translate:e.translate,$add:e.$add,$change:e.$change,$message:{get:e.$message.get,show:e.$message.show}}:void 0}if("external"===e){var t={};return angular.forEach(l.form,function(e,n){t[n]=e.$get()}),t}},$new:function(e){l.form[e.name]?(console.error("Not allowed to use two forms with a same name, '"+e.name+"' is already being used in another form."),e.element.remove()):(e={data:{},dataSource:""!==e.dataSource&&void 0!==e.dataSource?e.dataSource:"",dependence:[],element:e.element,error:{},field:{},grForm:!0,id:n,labelType:""!==e.labelType&&void 0!==e.labelType?e.labelType:l.default.labelType,method:""!==e.method&&void 0!==e.method?e.method:l.default.method,model:e.model,name:e.name,scope:e.scope,translate:!0,validated:!1,validate:""!==e.validate&&void 0!==e.validate?"false"!==e.validate&&e.validate!==!1:l.default.validate,valid:!1,$add:function(t){e.field[t.name]?(console.error("Not allowed to use two input fields with the same gr-name on the same form, '"+t.name+"' is already been used in '"+e.name+"' form."),t.element.remove()):(l.form[t.form]?t={attrs:{icon:t.attrs.icon,label:o.translate(e,t.attrs.label),mask:t.attrs.mask,type:t.attrs.type,dataSource:t.attrs.dataSource},changed:!1,"default":{value:t.value,checked:t.checked,multiple:t.multiple,innerElements:t.innerElements},element:t.element,error:"",error_messages:o.rules.parse(e,t.name,t.validate),form:t.form,id:a,innerElements:t.innerElements,input:angular.element(t.element).find(l.field[t.attrs.type].type),model:[],name:t.name,rules:o.rules.split(t.validate),requiredBy:[],scope:t.scope,state:"",validate:t.validate?!0:!1,valid:!0,value:"",$change:function(n){n&&(0===t.model.length&&(t.model=n.model),t.value=void 0!==n.value&&""!==n.value?n.submiting?t.value:n.value:void 0!==t.default.value&&""!==t.default.value?t.default.value:"",t.model.$setViewValue(t.value));var r=t.value,a=t.model;if(e.validate){if("onSubmit"===e.method&&!e.validated)return void i.timeout(function(){i.window.trigger("resize")});if("onChange"===e.method&&!t.changed&&!e.validated)return i.timeout(function(){i.window.trigger("resize")}),void(t.changed=!0);t.$check(r,a)}i.timeout(function(){i.window.trigger("resize")})},$check:function(n,r){var a=0;t.validate?(angular.forEach(l.rules,function(r){t.rules[r.name]&&0===a&&(r.rule(n,t.rules[r.name],e.field,t)?e.$error.unset(t.id):(e.$error.set({id:t.id,message:t.error_messages[r.name]}),a++),e.$message.change("danger","form"),e.$change())}),0===a?(t.$state.set("success"),t.valid=!0,r.$setValidity(t.name,!0)):(t.$state.set("error"),t.valid=!1,r.$setValidity(t.name,!1))):(e.$change(),t.valid=!0,r.$setValidity(t.name,!0))},$config:function(){t.$mask.set(),t.rules.hasOwnProperty("equalTo")&&l.form[t.form].field[t.rules.equalTo].requiredBy.push(t.name),l.form[t.form].field[t.name]=t,a++},$data:{set:function(n){var r=function(){n?l.field[t.attrs.type].set.data(n,t):(l.field[t.attrs.type].set.defaultData(e.data[t.name],t),l.field[t.attrs.type].set.attrs(e,t),l.field[t.attrs.type].set.scope(e,t))};t.attrs.dataSource?i.http.get(t.attrs.dataSource).then(function(e){l.field[t.attrs.type].set.defaultData(e.data.response,t),r()},function(){r()}):r()}},$mask:{object:{},type:"",set:function(){t.attrs.mask&&(l.config.file.mask[t.attrs.mask]?(t.$mask.type="string",t.attrs.mask=l.config.file.mask[t.attrs.mask]):(t.$mask.type="string",t.attrs.mask=""))}},$modelName:function(e){var t=/[a-zA-Z0-9]+/g,n=/[^a-zA-Z0-9]+/g,r=[],a=!1;return n.test(e)?(angular.forEach(e.split(""),function(e){e.match(t)?(a&&(e=e.toUpperCase(),a=!1),r.push(e)):a=!0}),r.join("")):e},$reset:function(){t.$state.set(""),t.model.$setViewValue(t.default.value),l.field[t.attrs.type].reset(e,t),t.$change({value:"",model:t.model})},$state:{set:function(e){t.state=e,t.scope.state=e}}}:i.timeout(function(){l.$add(t)}),t.$config(),e.$data.hasData||t.$data.set())},$change:function(t){t?(e.field[t.field].$change(t),e.field[t.field].requiredBy.length>0&&angular.forEach(e.field[t.field].requiredBy,function(t){e.field[t].$change()})):i.scope.$broadcast("form"+e.name+"change")},$check:function(){return void 0===e.valid?!1:e.valid===!0},$config:function(){e.$scope(),e.model.$id=String(e.id),e.model.$name=e.name;var t=i.scriptbind.get(),r=0;if(angular.forEach(t,function(){r++}),r>0){var a=i.scriptbind.get("grForm/form")[e.name];angular.isFunction(a)&&(l.config.form[e.name]=i.scriptbind.get("grForm/form")[e.name])}if(l.config.form.hasOwnProperty(e.name)){var s=l.config.form[e.name](e.scope);if(s.hasOwnProperty("submit")&&e.$submit.set(s.submit),""!==e.dataSource&&(s["data-source"]=e.dataSource),s.hasOwnProperty("data-source")){var o=s["data-source"];e.$data.hasData=!0,"string"==typeof o?i.http.get(o).then(function(t){e.data=t.data.response,angular.forEach(e.field,function(e){e.$data.set()})},function(e){console.error(e)}):"object"==typeof o&&(e.data=o)}s.hasOwnProperty("translate")&&"boolean"==typeof s.translate&&(e.translate=s.translate),s.hasOwnProperty("inject")&&e.$dependece.set(s.inject)}else console.error('Not found configuration of "'+e.name+'" form, so it is not possible to send or receive data.');e.element.bind({submit:function(t){t.preventDefault(),e.$validate()},reset:function(t){t.preventDefault(),e.$reset()}}).attr("novalidate",!0),l.form[e.name]=e,n++},$data:{hasData:!1,set:function(e){l.data=e}},$dependece:{set:function(t){"string"==typeof t?e.dependence=config.inject:angular.forEach(t,function(t){e.dependence.push(t)})}},$error:{set:function(t){e.error[t.id]=t.message,e.valid=!1},unset:function(t){delete e.error[t];var n=0;angular.forEach(e.error,function(){n++}),e.valid=0===n?!0:!1}},$get:function(){return{data:function(t){if(!t){var n={};return angular.forEach(e.field,function(e){n[e.name]=e.value}),n}"object"==typeof t&&angular.forEach(t,function(t,n){e.field[n]&&e.field[n].$data.set(t)})},element:e.element,grForm:e.grForm,noAjaxSubmit:e.$noAjaxSubmit,reset:e.$reset,submit:e.$validate,translate:e.translate}},$message:{type:"",trigger:"",text:{},get:function(){var t={};return"object"==String(typeof e.$message.text)?angular.forEach(e.$message.text,function(e,n){t[n]=e}):t=e.$message.text,{type:e.$message.type,trigger:e.$message.trigger,text:t}},change:function(t,n,r){e.$message.type=t,e.$message.trigger=n,e.$message.text=r&&"form"!==n?r:e.error,e.$change(),i.timeout(function(){i.window.trigger("resize")})},show:function(t,n){e.$message.change(t,"show",o.translate(e,n))}},$noAjaxSubmit:function(t,n,r){return t?(n=n||"POST",r=r||"multipart/form-data",e.element.attr({action:t,method:n,enctype:r}),void e.element[0].submit()):!1},$status:{set:function(t){"boolean"===String(typeof t)&&(e.validate=t)}},$scope:function(){e.scope.form={reset:e.$reset,submit:e.$validate},e.scope.__=o.translate},$submit:{fn:"",set:function(t){e.$submit.fn=t},exec:function(t){var n=e.$submit.fn;if("function"===String(typeof n))n(t);else{var r,o,a=[],s=0;angular.forEach(n,function(t){"string"==typeof t?(r=angular.isArray(e.dependence)&&e.dependence.length>0?angular.injector(e.dependence):i.injector,a.push(r.get(t)),s++):"function"==typeof t&&"function"!=typeof o&&(o=t)}),a.push(t),a.push(l.$get(e.name)),o.apply(null,a)}}},$reset:function(){e.validated=!1,e.valid=!0,angular.forEach(e.field,function(e){e.$reset()}),e.$message.type="",e.$message.trigger="",e.$message.text={},i.scope.$broadcast("form"+e.name+"change")},$validate:function(){if(e.validate){if(e.validated=!0,angular.forEach(e.field,function(e){i.scope.$broadcast(e.form+e.name+"submit")}),e.$check()){var t=e.$get().data();return void e.$submit.exec(t)}var n;return angular.forEach(e.field,function(e){e.valid||n||(n=e.input)}),void n.focus()}e.$submit.exec(e.element.serializeArray())}},e.$config())},$rule:{set:function(e){angular.forEach(e,function(e,t){if("function"===String(typeof e.rule)){var n=0,r=0;angular.forEach(l.rules,function(a,i){a.name===t&&(l.rules[i]={name:t,type:e.type,rule:e.rule,parse:e.parse?e.parse:!1},n++),r++}),0===n&&(l.rules[r]={name:t,type:e.type,rule:e.rule,parse:e.parse?e.parse:!1})}})}},$translator:{set:function(e){l.translator.enable=e.enable,l.translator.module=e.module}}},o={translate:function(e,t){function n(e){return l.translator.enable&&"pascalprecht.translate"===l.translator.module?i.filter("translate")(e):e}return"object"==typeof e&&e.grForm?e.translate?n(t):t:"string"==typeof e?n(e):"string"==typeof t?t:""},mask:{replace:function(e){for(var t=/[\/\\\.\_\-\(\)\:\%\?\!\+\=\@\&\Âª\Âº\Â¹\Â²\Â³\R\$\Â£\Â¢\ ]/g;e.match(t);)e=e.replace(t,"");return e},split:function(e){var t="";return-1!==e.indexOf("|")?(t=[],angular.forEach(e.split("|"),function(e,n){for(var r=e;-1!==r.indexOf(" ");)r=r.replace(" ","");t[n]={mask:e.trim(),length:r.trim().length}}),t.sort(function(e,t){return e.length-t.length})):t=e.trim(),t}},rules:{split:function(e){e=""!==e&&void 0!==e&&e?e:"required:false",e=e.split(",");var t={};return e&&angular.forEach(e,function(e){e=e.split(":");for(var n=e[0].trim(),r=e[1].trim(),a=!1;-1!=r.indexOf("'");)r=r.replace("'","").trim();angular.forEach(l.rules,function(e){if(n===e.name){var t=e.type;"integer"===t?r=parseInt(r)||"":"float"===t?r=parseFloat(r)||"":"boolean"===t?r="true"===String(r):"string"===t&&(r=String(r)||""),("integer"===t||"float"===t)&&(t="number"),typeof r===t&&(a=!0)}}),a&&(t[n]=r)}),t},parse:function(e,t,n){var r=l.config.file.message[t],a={};return n=o.rules.split(n),angular.forEach(n,function(n,i){if(!r)return void console.error('No error message was defined for "'+t+'" field.');if(r[i]){var s,f;angular.forEach(l.rules,function(e){e.name==i&&(f=e)}),r[i]=o.translate(e,r[i]),f.parse?(s=r[i],s=f.parse(s,n)):s=r[i],a[i]=s}else console.error('No error message was defined for "'+i+'" in "'+t+'" field.')}),a}}},this.destroy=l.$destroy,this.config=function(e){if(e.hasOwnProperty("config")&&"object"==typeof e.config&&l.config.$form.set(e.config),e.hasOwnProperty("files")){var t=e.files;t.hasOwnProperty("templates")?(l.config.file.$template.path=t.templates.location||"",l.config.file.$template.extension=t.templates.extension||".html"):(l.config.file.$template.path="",l.config.file.$template.extension=".html"),t.hasOwnProperty("messages")?l.config.file.$message.url=t.messages:console.error("Form messages files not found!"),t.hasOwnProperty("masks")&&(l.config.file.$mask.url=t.masks)}else l.config.file.$template.path="",l.config.file.$template.extension=".html",console.error("Form messages files not found!");if(e.hasOwnProperty("translator")||e.translator){var n={enable:e.translator.enable||!1,module:e.translator.enable?e.translator.module:""};l.$translator.set(n)}},this.showMessage=l.config.file.$message.show,s=function(e){i.injector=e,i.scriptbind=i.injector.get("$grScriptbind"),i.scope=i.injector.get("$rootScope"),i.filter=i.injector.get("$filter"),i.http=i.injector.get("$http"),i.compile=i.injector.get("$compile"),i.timeout=i.injector.get("$timeout"),i.window=angular.element(i.injector.get("$window")),u.fields=i.injector.get("$grValidation.fields"),l.$field.set(u.fields),u.rules=i.injector.get("$grValidation.rules"),l.$rule.set(u.rules),u.masks=i.injector.get("$grValidation.mask.patterns"),l.config.file.$mask.config=u.masks,l.config.form&&0!==l.config.form.length||(u.config=i.injector.get("$grValidation.config"),l.config.$form.set(u.config)),i.http.get(l.config.file.$message.url).then(function(e){var t={};angular.forEach(e.data,function(e,n){t[n]={},angular.forEach(e,function(e,r){t[n][r]=e,l.translate&&(t[n][r]=o.translate(e))})}),l.config.file.$message.set(t)},function(e){console.error(e)}),i.http.get(l.config.file.$mask.url).then(function(e){l.config.file.$mask.set(e.data)}),l.config.file.$template.set()},this.$get=["$injector",function(e){return s(e),{"new":l.$new,get:l.$get,mask:l.config.file.$mask.config,template:l.config.file.$template.get,destroy:l.$destroy,translate:o.translate}}]}).config(["$grScriptbindProvider",function(e){e.addType("grForm/form",function(e,t){var n=angular.isArray(t)&&angular.isArray(t[0])?t.shift():void 0,r=t;angular.forEach(e,function(e){var t=angular.isFunction(e[0])?e[0].apply(null,n):e[0][0].apply(null,n);if(t.inject){var a=[],i=angular.injector(t.inject),s=t.submit.pop(),o=i.get(t.submit);a.push(o),angular.isArray(r)&&angular.forEach(r,function(e){a.push(e)}),s.apply(null,a)}})})}]),angular.module("grValidation.directive",["grValidation.provider"]).directive("grForm",["$grValidation",function(e){return{restrict:"E",transclude:!0,replace:!0,scope:!1,templateUrl:e.template("form"),require:"?^form",compile:function(){return{pre:function(t,n,r,a){r.grName?e.new({name:r.grName,element:n,scope:t,model:a,method:r.hasOwnProperty("grValidateMethod")?r.grValidateMethod:"",validate:r.hasOwnProperty("grValidate")?r.grValidate:"",labelType:r.hasOwnProperty("grLabelType")?r.grLabelType:"",dataSource:r.hasOwnProperty("grDataSource")?r.grDataSource:""}):(console.error('"gr-name" attribute not found.'),n.html(""))},post:function(t,n,r){r.grName&&(t.grForm=e.get("external"))}}}}}]).directive("grAlert",["$grValidation","$timeout",function(e){return{restrict:"A",scope:!0,templateUrl:e.template("alert"),require:"?^form",link:function(t,n,r,a){if(a&&a.$name&&a.$id){var i=e.get(a.$name);t.message={text:{},type:"",error:{title:e.translate(i,"Oops, something is wrong")},length:0,check:function(){return t.message.length>0}},t.$on("form"+a.$name+"change",function(){var e=i.$message.get();t.message.length=0,t.message.text=e.text,t.message.trigger=e.trigger,t.message.type=e.type,angular.forEach(e.text,function(){t.message.length++})})}}}}]).directive("grInput",["$grValidation","$compile",function(e){return{restrict:"E",replace:!0,scope:!0,require:"?^form",transclude:!0,templateUrl:function(t,n){return n.grType||(n.grType="text"),e.template(n.grType,!0)},compile:function(){var a,i;return{post:function(t,n,r,s){if(s&&s.$name&&s.$id){a=e.get(s.$name),i=n.find("gr-input-inner");var o={};i.length>0&&angular.forEach(i,function(e,t){o[t]={},angular.forEach(e.attributes,function(e){var n=e.nodeName,r=e.value;("class"!==n||"ng-scope"!==r)&&(o[t][n]="undefined"!==r&&""!==r?r:!0)})}),a.$add({form:s.$name,name:r.grName,element:n,innerElements:o,scope:t,validate:""!==r.grValidate&&void 0!==r.grValidate?r.grValidate:!1,attrs:{type:""!==r.grType&&void 0!==r.grType?r.grType:"text",mask:r.grMask,label:r.grLabel,icon:""!==r.grIcon&&void 0!==r.grIcon?r.grIcon:!1,value:r.grValue,checked:r.hasOwnProperty("grChecked")?!0:!1,multiple:r.hasOwnProperty("grMultiple")?!0:!1,dataSource:r.hasOwnProperty("grDataSource")?r.grDataSource:!1}}),n.find("gr-input-inner").parent().remove()}}}}}}]).directive("grValidator",["$grValidation",function(e){return{restrict:"A",priority:1,require:["?^form","ngModel"],compile:function(){return{post:function(t,n,r,a){var i=a[0],s=a[1];if(s&&i&&s.$name&&i.$name&&i.$id&&(s.$setValidity(s.$name,!1),s.$formatters=[],s.$parsers=[],t.model=s,r.grValidator===!0||"true"===r.grValidator||r.grValidator===!1||"false"===r.grValidator)){var o=e.get(i.$name),l=function(e,t){o.$change({field:s.$name,model:s,value:e,submiting:t|!1})};t.$watch("model.$viewValue",function(e){l(e)},!0),t.$on(i.$name+s.$name+"submit",function(){l(n.val(),!0)})}}}}}}]).directive("grMaskPattern",["$grValidation","$parse","$timeout",function(e,t){return{priority:101,require:"ngModel",restrict:"A",compile:function(){var n={maskDefinitions:e.mask,maskResources:{split:/\[\[([^(\[\[)]*)((\|\|)([^(\]\])]*)){0,1}\]\]/g,autoIncrement:/\&/g}};return function(e,r,a,i){function w(e){return angular.isDefined(o)?(I(),l.processed?(P(e),F(),!0):T()):T()}function b(e){angular.isDefined(e)&&(m||(l.placeholder=e),l.processed&&z())}function k(e){return l.processed?(c=N(e||""),g=Y(c),i.$setValidity("mask",g),g&&c.length?H(c):void 0):e}function D(e){return l.processed?(c=N(e||""),g=Y(c),i.$viewValue=c.length?H(c):"",i.$setValidity("mask",g),""===c&&a.required&&i.$setValidity("required",!1),g?c:void 0):e}function V(e){function i(e,t){var n=0;return e.length>1&&angular.forEach(e,function(e){var r=E(e.value);r.length===t.length&&n++}),n>0}var t;if("string"==typeof e)if(/[^\|]\|[^\|]/.test(e)){l.multiMask=!0,t=[];var n=e.split(""),r="";angular.forEach(n,function(e,t){r+=t>0&&"|"===e&&"|"!==n[t-1]&&"|"!==n[t+1]&&" "!==n[t-1]&&" "!==n[t+1]?" | ":e}),n=r.split(/\ \|\ /),angular.forEach(n,function(e){var r=E(e);i(t,r)||j("split",e)||j("autoIncrement",e)||t.push({value:e.trim(),length:r.length})}),t.length>0?t.sort(function(e,t){return e.length-t.length}):t=""}else{l.multiMask=!1;var a=E(e);t=[{value:e.trim(),length:a.length}]}else l.multiMask=!0,t=[e];return t}function E(e,t){var r,n="";return angular.forEach(M.maskResources,function(t){r=e.match(t)||!1,r="string"!==r?r[0]:r,r=e.split(r).join("")||!1,e=r||e}),e=e.trim(),angular.forEach(e.split(""),function(e){var a=t?!0:M.maskDefinitions[e];a&&(n+=e)}),n.trim()}function S(e){c||(c="");var t=c;e&&(t=e);var r,a,n=t.length;if(O(n)){if("object"==typeof o?angular.forEach(o,function(e,t){0===t?(r=e.value,a=t):n>o[t-1].length&&(r=e.value,a=t)}):r=o,j("split",r)){var u,i=r.match(M.maskResources.split)[0],s=r.split(i),f=E(r).length,d=[];if(n>f){for(var g=1;!u;g++){var m=s[1].substring(g-1,g);if(M.maskDefinitions[m]&&(u=m),!m)return}if(s.length>2){var d=[],p="";angular.forEach(s,function(e,t){0===t?d.push(e):p+=e}),s=d,s.push(p)}i=i.split("[[").join("").split("]]").join("").split("||"),i={delimiter:parseInt(i[0])||!1,divisor:i[1]||!1};var h=[];if(angular.forEach(i.divisor.split(""),function(e){h.push(M.maskDefinitions[e]?"\\"+e:e)}),i.divisor=h.join(""),d[0]=s[0],u&&i.delimiter&&i.delimiter>0)if(i.divisor)for(var g=n-f;g>0;g--)d.push(u),g%i.delimiter===0&&d.push(i.divisor);else for(var g=n-f;g>0;g--)g<i.delimiter&&d.push(u);r=d,r.push(s[1]),r=r.join("")}else r=E(o[a].value,!0)}else if(j("autoIncrement",r)){var d=[],u="",f=E(r).length;if(n>f){d[0]="",d[1]="",d[2]="",angular.forEach(r.split("&"),function(e,t){0===t?d[0]+=e:d[2]+=e}),u=d[2].substring(0,1);for(var g=n-f;g>0;g--)d[1]+=u;r=d.join("")}else r=E(o[a].value,!0)}}else r=l.pattern?l.pattern:"";return r}function O(e){return p&&(parseInt(p)||0)>0?p>=e:!0}function j(e,t){var n;return n=M.maskResources[e].test(t)}function T(){return l.processed=!1,A(),angular.isDefined(m)?r.attr("placeholder",m):r.removeAttr("placeholder"),angular.isDefined(p)?r.attr("maxlength",p):r.removeAttr("maxlength"),r.val(i.$modelValue),i.$viewValue=i.$modelValue,!1}function P(e){if(c=v=N(i.$modelValue||""),d=h=H(c),g=Y(c),e)var t=d;else var t=g&&c.length?d:"";a.maxlength&&r.attr("maxlength",2*l.caretMap[l.caretMap.length-1]),(""===m||void 0===m)&&r.attr("placeholder",l.placeholder),r.val(t),i.$viewValue=t}function F(){s||(r.bind("blur",R),r.bind("mousedown mouseup",C),r.bind("input keyup click focus",z),s=!0)}function A(){s&&(r.unbind("blur",R),r.unbind("mousedown",C),r.unbind("mouseup",C),r.unbind("input",z),r.unbind("keyup",z),r.unbind("click",z),r.unbind("focus",z),s=!1)}function Y(e){return e.length?e.length>=u:!0}function N(e){var t="",n=l.patterns.slice();for(e=e.toString(),angular.forEach(l.components,function(t){e=e.replace(t,"")});-1!==e.indexOf("_");)e=e.replace("_","");return angular.forEach(e.split(""),function(e){parseInt(n.length)>0&&n[0].test(e)?(t+=e,n.shift()):0!==parseInt(n.length)||n[0]||(t+=e)}),t}function H(e){var t="",n=l.caretMap.slice();return angular.forEach(l.placeholder.split(""),function(r,a){e.length&&a===n[0]?(t+=e.charAt(0)||"_",e=e.substr(1),n.shift()):t+=r}),t}function q(e){var t=a.placeholder;return m?"_":"undefined"!=typeof t&&t[e]?t[e]:"_"}function _(){var e=[];return angular.forEach(l.placeholder.replace(/[_]+/g,"_").replace(/([^_]+)([a-zA-Z0-9])([^_])/g,"$1$2_$3").split("_"),function(t){t.length<=1?e.push(t):(e.push(t),angular.forEach(t.split(""),function(t){-1===e.indexOf(t)&&e.push(t)}))}),e}function I(){function e(e){var t=0;u=0;var n={caretMap:[],patterns:[],placeholder:"",components:[],multiMask:l.multiMask,processed:!1},r=!1,i=e.split("");angular.forEach(i,function(e,a){M.maskDefinitions[e]&&"\\"!==i[a-1]?(n.caretMap.push(t),n.placeholder+=q(a),n.patterns.push(M.maskDefinitions[e]),t++,r||u++):"?"===e?r=!0:("\\"!==e||"\\"===e&&!M.maskDefinitions[i[a+1]])&&(n.placeholder+=e,t++)}),n.pattern=e,l=n}angular.forEach(l,function(e,t){f[t]=e}),l.caretMap=[],l.patterns=[],l.placeholder="","string"==typeof o&&(o=V(o)),e(S()),l.caretMap.push(l.caretMap.slice().pop()+1),l.components=_(),l.processed=l.caretMap.length>1?!0:!1}function R(){$=0,y=0,g&&0!==c.length||(d="",r.val(""),e.$apply(function(){i.$setViewValue("")}))}function C(e){"mousedown"===e.type?r.bind("mouseout",B):r.unbind("mouseout",B)}function B(){y=W(this),r.unbind("mouseout",B)}function z(t){t=t||{};var n=t.which,a=t.type;if(16!==n&&91!==n){var f,s=r.val(),o=h,u=N(s),c=v,d=!1,g=S(u)!==l.pattern,m=Z(this)||0,p=$||0,b=m-p,k=l.caretMap[0],D=l.caretMap[u.length]||l.caretMap.slice().shift(),M=y||0,x=W(this)>0,V=M>0,E=s.length>o.length||M&&s.length>o.length-M,O=s.length<o.length||M&&s.length===o.length-M,j=n>=37&&40>=n&&t.shiftKey,T=37===n,P=8===n||"keyup"!==a&&O&&-1===b,F=46===n||"keyup"!==a&&O&&0===b&&!V,A=(T||P||"click"===a)&&m>k;if(y=W(this),!j&&(!x||"click"!==a&&"keyup"!==a)){if(g)return!A&&L(m+1)&&!L(m-1)&&m>0&&!F&&m++,w(!0),$=m,m+=U(m),f=H(u),u.length>0&&(D=g?f.length:l.caretMap[u.length]),h=f,v=u,r.val(f),e.$apply(function(){i.$setViewValue(u)}),void K(this,m);if("input"===a&&O&&!V&&u===c){for(;P&&m>k&&!L(m);)m--;for(;F&&D>m&&-1===l.caretMap.indexOf(m);)m++;var Y=l.caretMap.indexOf(m);u=u.substring(0,Y)+u.substring(Y+1),d=!0}for(f=H(u),u.length>0&&(D=g?f.length:l.caretMap[u.length]),h=f,v=u,r.val(f),d&&e.$apply(function(){i.$setViewValue(u)}),E&&k>=m&&(m=k+1),A&&-m--,m=m>D?D:k>m?k:m;!L(m)&&m>k&&D>m;)m+=A?-1:1;(A&&D>m||E&&!L(p))&&m++,$=m,K(this,m)}}}function U(e){var t=0,n=0,r=l.pattern,a=f.pattern;return angular.forEach(r.split(""),function(n,r){l.components.indexOf(n)>-1&&e>r&&t++}),angular.forEach(a.split(""),function(t,r){f.components.indexOf(t)>-1&&e>r&&n++}),t-n}function L(e){return l.caretMap.indexOf(e)>-1}function Z(e){if(!e)return 0;if(void 0!==e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();return t.moveStart("character",e.value?-e.value.length:0),t.text.length}return 0}function K(e,t){if(!e)return 0;if(0!==e.offsetWidth&&0!==e.offsetHeight)if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}function W(e){return e?void 0!==e.selectionStart?e.selectionEnd-e.selectionStart:document.selection?document.selection.createRange().text.length:0:0}var o,u,c,d,g,h,v,$,y,s=!1,l={},f={},m=a.placeholder,p=a.maxlength,M={};a.gOptions?(M=e.$eval("["+a.gOptions+"]"),angular.isObject(M[0])&&(M=function(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]?angular.extend(t[n],e[n]):t[n]=angular.copy(e[n]));return t}(n,M[0]))):M=n,a.$observe("grMaskPattern",function(e){if(o=e,w(),a.grValue){if(c=N(a.grValue),c.length<E(l.pattern).length)return void(c="");w(!0)}}),a.$observe("placeholder",b);var x=!1;a.$observe("modelViewValue",function(e){"true"===e&&(x=!0)}),e.$watch(a.ngModel,function(n){if(x&&n){var r=t(a.ngModel);r.assign(e,i.$viewValue)}}),i.$formatters.push(k),i.$parsers.push(D),r.bind("mousedown mouseup",C),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>1&&(r=Number(arguments[1]),r!==r?r=0:0!==r&&1/0!==r&&r!==-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var a=r>=0?r:Math.max(n-Math.abs(r),0);n>a;a++)if(a in t&&t[a]===e)return a;return-1})}}}}]);
